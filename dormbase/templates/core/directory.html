{% extends "base.html" %}
{% block classDirectory %}class="active"{% endblock %}
{% block content %}

<div class="row">     
<div class="span4">
<form id="searchform" class="form-horizontal">
<fieldset>
<legend>Search the Directory</legend>
<div class="control-group">
    <label for="firstname">First name</label>
    <div class="controls">
        <input id="firstname" name="firstname" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="lastname">Last name:</label>
    <div class="controls">
        <input id="lastname" name="lastname" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="title">Title:</label>
    <div class="controls">
        <input id="title" name="title" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="username">Username:</label>
    <div class="controls">
        <input id="username" name="username" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="room">Room:</label>
    <div class="controls">
        <input id="room" name="room" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="year">Year:</label>
    <div class="controls">
        <input id="year" name="year" type="text" class="input-medium">
    </div>
</div>
<div class="control-group">
    <label for="lounge">Lounge:</label>
    <div class="controls">
        <select id="lounge" name="lounge" class="input-medium"></select>
    </div>
</div>
<div class="control-group">
    <label for="grt">GRT:</label>
    <div class="controls">
        <select id="grt" name="grt" class="input-medium"></select>
    </div>
</div>

<div class="form-actions">
    <button type="submit" class="btn btn-primary">Search Directory</button>
    <button type="reset" class="btn">Clear</button>
</div>
</fieldset>
</form>
</div>

<div class="span8">
<legend style="margin-bottom: 15px">Results</legend>
<table class="table table-bordered table-striped">
<thead>
<tr><th>Username</th><th>First Name</th><th>Last Name</th><th>Room</th><th>Year</th></tr>
</thead>
<tbody id="results" name="results"></tbody>
</table>
</div>
</div>

<script>
function userToHTML(user) {
    s = '<tr><td>' + user.username + '</td>';
    s += '<td>' + user.firstname + '</td>';
    s += '<td>' + user.lastname + '</td>';
    s += '<td>' + user.room + '</td>';
    s += '<td>' + user.year + '</td>';
    s += '</tr>'
    return s;
}

function search() {
    $.ajax({
	type: "GET",
	url: "{% url dormbase.core.views.directory_json %}",
	data: $("#searchform").serialize(),
    }).done(function(search_json) {
	$("#results").html("");
	for (var index in search_json.result) {
            $("#results").append(userToHTML(search_json.result[index]));
	}
    });
}

$("#firstname").keyup(function() { search(); });
$("#lastname").keyup(function() { search(); });
$("#title").keyup(function() { search(); });
$("#username").keyup(function() { search(); });
$("#room").keyup(function() { search(); });
$("#year").keyup(function() { search(); });
</script>

{% endblock %}

